<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, April 08, 2022, 5:17 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Keyring_Storage" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Keyring_Storage"
   author="Gaballon"
   id="1e922c234822a609f6f05d9e"
   language="Lua"
   purpose="Automate storage of keys into a container."
   save_state="y"
   date_written="2022-04-08 17:16:05"
   requires="5.07"
   version="1.0"
   >

</plugin>

<triggers>
  
  <trigger
   enabled="y"
   group="script-keyring"
   match="^\{\/keyring\}$"
   regexp="y"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>
  store_keys()
  </send>
  </trigger>
  
  <trigger
   group="script-keyring"
   match="^(\d{3,})\,(.*+)$"
   regexp="y"
   omit_from_output="y"
   send_to="12"
   sequence="100"
  >
  <send>
  build_list(%1)
  </send>
  </trigger>
</triggers>

<aliases>
  <alias
   match="getkeys"
   enabled="y"
   expand_variables="y"
   group="script-keyring"
   send_to="12"
   sequence="100"
  >
  <send>
  get_keys()
  </send>
  </alias>
  <alias
   match="dropkeys"
   enabled="y"
   expand_variables="y"
   group="script-keyring"
   send_to="12"
   sequence="100"
  >
  <send>
  drop_keys()
  </send>
  </alias>
</aliases>

<script>
<![CDATA[

require "tprint"

function build_list(id)
	print(tostring(id), "added to key_list table.")
	table.insert(key_list, tostring(id))
end

function store_keys()
	--print("Putting keys into", keybag .. ".")
	for i, v in ipairs (key_list) do
		SendSpecial("put " .. tostring(v) .. " " .. keybag, false, false, true, false)
	end
	--print("Finished putting keys into", keybag .. ".")
	SendSpecial("unkeep " .. keybag, false, false, true, false)
	SendSpecial("drop " .. keybag, false, false, true, false)
	EnableTriggerGroup("script-keyring", false)
end

function get_keys()
	SendSpecial("get " .. keybag, false, false, true, false)
	SendSpecial("keep " .. keybag, false, false, true, false)
	SendSpecial("get all " .. keybag, false, false, true, false)
	SendSpecial("keyring put all", false, false, true, false)
end

function drop_keys()
	--print("Putting all keys into", keybag, "and dropping in storage.")
	EnableTriggerGroup("script-keyring", true)
	key_list = {}
	SendSpecial("keyring data", false, false, true, false)
	SendSpecial("keyring get all", false, false, true, false)
end

function init()
	keybag = tostring(2652688146)
	EnableTriggerGroup("script-keyring", false)
	key_list = {}
end

function OnPluginInstall()
	OnPluginEnable()
end

function OnPluginEnable()
	print("Keyring_Storage plugin enabled.")
	init()
end

function OnPluginSaveState()

end

function OnPluginDisable()

end

function OnPluginClose()
	OnPluginDisable()
end

]]>
</script>

</muclient>
